<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Generator Area Pak Fadholi v2.4.1</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --midi-red: #c1121c; 
            --off-white: #f8fafc; 
            --pure-white: #ffffff;
            --border-color: #e2e8f0;
            --text-dark: #1e293b;
            --text-muted: #64748b;
        }

        * { box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--off-white); margin: 0; padding: 0; color: var(--text-dark); }
        
        .navbar { 
            background: var(--pure-white); 
            padding: 14px 20px; 
            font-weight: 700; 
            font-size: 13px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .main-content { padding: 12px; max-width: 600px; margin: 0 auto; }

        .card { 
            background: var(--pure-white); 
            border-radius: 8px; 
            border-top: 4px solid var(--midi-red);
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            margin-bottom: 16px;
            overflow: hidden;
        }

        textarea { 
            width: 100%; border: none; padding: 15px; font-size: 12px;
            outline: none; resize: none; background: transparent;
            min-height: 80px;
        }

        .menu-list { display: flex; flex-direction: column; }
        .btn-action {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            background: none;
            border: none;
            padding: 12px 16px;
            font-weight: 700;
            font-size: 11px;
            color: var(--text-dark);
            cursor: pointer;
            border-top: 1px solid var(--border-color);
            text-transform: uppercase;
        }
        .btn-process { color: var(--midi-red); }

        .monitoring-title { font-size: 10px; font-weight: 700; color: var(--text-muted); margin-bottom: 8px; text-transform: uppercase; }

        .table-scroll { 
            height: 400px; 
            overflow: auto; 
            background: var(--pure-white);
            border: 1px solid var(--border-color);
            border-radius: 6px;
        }

        table { border-collapse: collapse; width: 100%; min-width: 1100px; font-size: 11px; }
        th { position: sticky; top: 0; background: #f8fafc; padding: 10px; color: var(--text-muted); border-bottom: 2px solid #edf2f7; z-index: 10; font-size: 10px; }
        td { padding: 8px 4px; border-bottom: 1px solid #f1f5f9; text-align: center; vertical-align: top; }
        
        .toko-col { 
            position: sticky; left: 0; background: #fffdf2; 
            z-index: 5; border-right: 2px solid #ffcc00; 
            min-width: 115px; text-align: left; vertical-align: middle;
        }
        .nama-full { display: block; font-size: 8px; color: #666; text-transform: uppercase; line-height: 1.1; }
        .nama-kode { display: block; font-size: 11px; color: var(--midi-red); font-weight: 700; }

        .target-label { display: block; font-size: 9px; color: #94a3b8; font-weight: bold; margin-bottom: 4px; }
        
        input[type="text"] { 
            width: 80px; padding: 6px; border: 1px solid #cbd5e1; 
            border-radius: 6px; text-align: center; font-size: 11px; font-weight: bold;
        }
        .acv-indicator { display: block; font-size: 9px; font-weight: bold; color: #059669; margin-top: 3px; }

        #toast { position: fixed; bottom: 35px; left: 50%; transform: translateX(-50%); background: #1e293b; color: white; padding: 10px 20px; border-radius: 30px; font-size: 11px; font-weight: bold; opacity: 0; transition: 0.4s; z-index: 2000; }
        
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); display: none; justify-content: center; align-items: center; z-index: 1000; padding: 20px; }
        .modal { background: #fff; width: 100%; max-width: 300px; border-radius: 12px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        
        /* SCROLL UNTUK POPUP */
        .modal-body {
            max-height: 100px; /* Tinggi dibatasi agar hanya muncul 3 baris */
            overflow-y: auto;
            padding: 15px;
            font-size: 11px;
            color: #334155;
            line-height: 1.8;
            border-bottom: 1px solid var(--border-color);
        }
    </style>
</head>
<body>

<div class="navbar">
    GENERATOR
    <span style="font-size: 10px; color: var(--text-muted); font-weight: 400;">v2.4.1</span>
</div>

<div class="main-content">
    <div class="card">
        <textarea id="rawInput" placeholder="Tempel laporan mentah di sini..."></textarea>
        <div class="menu-list">
            <button class="btn-action btn-process" onclick="importData()">PROSES DATA <span>‚ùØ</span></button>
            <button class="btn-action" onclick="copyWA()">SALIN LAPORAN <span>‚ùØ</span></button>
            <button class="btn-action" style="color: #94a3b8;" onclick="clearAll()">HAPUS <span>‚ùØ</span></button>
        </div>
    </div>

    <div class="monitoring-title">Data Monitoring (Total 10 Toko)</div>
    <div class="card" style="padding: 8px;">
        <div class="table-scroll" id="tableContent"></div>
    </div>
</div>

<div id="toast">Berhasil Disalin</div>

<div class="modal-overlay" id="updateModal">
    <div class="modal">
        <div style="padding: 15px; background: var(--midi-red); color: white; font-weight: 700; text-align: center; font-size: 13px;">UPDATE DASHBOARD</div>
        <div class="modal-body">
            1. Tampilan layar muat 6 Toko.<br>
            2. Catatan Tambahan dihapus.<br>
            3. Nama Toko Full Version.<br>
            4. Perbaikan Target TTM.<br>
            5. Optimalisasi Copy WhatsApp.
        </div>
        <button onclick="closeModal()" style="width: 100%; padding: 12px; border: none; background: #ffffff; color: var(--midi-red); font-weight: 700; cursor: pointer;">MENGERTI</button>
    </div>
</div>

<script>
    const tokoList = [
        { n: "ANBA", full: "ALUN-ALUN BLORA", s: "17599926", aq: "55", dk: "5", gr: "1", lf: "1", pp: "2", sn: "2", tm: "50" },
        { n: "YNPW", full: "A. YANI PURWODADI", s: "21645276", aq: "33", dk: "4", gr: "1", lf: "1", pp: "5", sn: "4", tm: "50" },
        { n: "GDGN", full: "GODONG GROBOGAN", s: "25401388", aq: "23", dk: "4", gr: "1", lf: "1", pp: "5", sn: "5", tm: "50" },
        { n: "GRGB", full: "GUBUG GROBOGAN", s: "28622850", aq: "34", dk: "6", gr: "1", lf: "1", pp: "6", sn: "8", tm: "50" },
        { n: "PLMN", full: "PLAMONGAN", s: "21523517", aq: "25", dk: "5", gr: "1", lf: "1", pp: "6", sn: "8", tm: "50" },
        { n: "FMI",  full: "FATMAWATI", s: "25512077", aq: "30", dk: "4", gr: "1", lf: "2", pp: "5", sn: "7", tm: "50" },
        { n: "WMI",  full: "WOLTER MONGINSIDI", s: "17526288", aq: "24", dk: "3", gr: "1", lf: "1", pp: "4", sn: "4", tm: "50" },
        { n: "PDA",  full: "PADIRAYA", s: "21904787", aq: "35", dk: "4", gr: "1", lf: "2", pp: "6", sn: "3", tm: "50" },
        { n: "KTL",  full: "KETILENG", s: "15492335", aq: "32", dk: "4", gr: "1", lf: "1", pp: "12", sn: "2", tm: "50" },
        { n: "CRLW", full: "CEPU RONGGOLAWE", s: "15421747", aq: "55", dk: "6", gr: "1", lf: "1", pp: "12", sn: "3", tm: "25" }
    ];

    const fields = ['s','aq','dk','gr','lf','pp','sn','f','tm','p','cs'];
    const container = document.getElementById('tableContent');
    
    let html = `<table><thead><tr><th>TOKO</th><th>SALES</th><th>AQUA</th><th>D.KELINCI</th><th>GARNIER</th><th>LIFEBUOY</th><th>PEPSODENT</th><th>SUNLIGHT</th><th>FRUIT</th><th>TTM</th><th>PULSA</th><th>CASHBACK</th></tr></thead><tbody>`;
    tokoList.forEach((tk, i) => {
        html += `<tr><td class="toko-col"><span class="nama-full">${tk.full}</span><span class="nama-kode">${tk.n}</span></td>`;
        fields.forEach(f => {
            let tgtDisp = (f==='p')?'200k':(f==='tm'?(tk.n==='CRLW'?'25':'50'):(f==='f'?'Fruit':(f==='cs'?'Cash':(f==='s'?formatNumber(tk[f]):tk[f]))));
            let tgtVal = (f==='p')?'200':(f==='tm'?(tk.n==='CRLW'?'25':'50'):(tk[f]||'0'));
            html += `<td><span class="target-label">${tgtDisp}</span><input type="text" id="${f}_${i}" oninput="calc('${i}','${f}','${tgtVal}')"><span id="acv_${f}_${i}" class="acv-indicator">0%</span></td>`;
        });
        html += `</tr>`;
    });
    container.innerHTML = html + `</tbody></table>`;

    window.onload = () => document.getElementById('updateModal').style.display = 'flex';
    function closeModal() { document.getElementById('updateModal').style.display = 'none'; }
    function formatNumber(n) { return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."); }
    function showToast(m) { const t = document.getElementById('toast'); t.innerText = m; t.style.opacity = '1'; setTimeout(() => t.style.opacity = '0', 2000); }

    function calc(i, f, target) {
        let val = document.getElementById(`${f}_${i}`).value.replace(/[^0-9]/g, '');
        let a = parseInt(val) || 0, t = parseInt(target.replace(/[^0-9]/g, '')) || 0;
        document.getElementById(`acv_${f}_${i}`).innerText = (t > 0) ? Math.round((a/t)*100) + "%" : "0%";
    }

    function clearAll() {
        document.querySelectorAll('textarea, input').forEach(el => el.value = "");
        document.querySelectorAll('.acv-indicator').forEach(el => el.innerText = "0%");
        showToast("BERSIH");
    }

    function importData() {
        const text = document.getElementById('rawInput').value.toUpperCase();
        if(!text) return;
        const lines = text.split('\n');
        let mode = "s";
        const keyMap = { "AQUA":"aq","KELINCI":"dk","GARNIER":"gr","LIFEBUOY":"lf","PEPSODENT":"pp","SUNLIGHT":"sn","FRUIT":"f","TTM":"tm","PULSA":"p","CASHBACK":"cs" };
        lines.forEach(line => {
            for (let key in keyMap) if(line.includes(key)) mode = keyMap[key];
            tokoList.forEach((tk, i) => {
                if(line.includes(tk.n)) {
                    let p = line.split('/').map(x => x.trim()).filter(x => x !== "");
                    let actual = (mode === 'f' || mode === 'cs') ? (p[1] || "") : (p[2] || "");
                    document.getElementById(`${mode}_${i}`).value = actual.replace(/[^0-9]/g, '');
                    let tgtV = (mode==='p')?'200':(mode==='tm'?(tk.n==='CRLW'?'25':'50'):(tk[mode]||'0'));
                    calc(i, mode, tgtV);
                }
            });
        });
        showToast("DIPROSES");
    }

    function copyWA() {
        const d = new Date(), jam = d.getHours();
        let shift = (jam >= 21) ? "SIANG" : "PAGI";
        const bln = ["JANUARI","FEBRUARI","MARET","APRIL","MEI","JUNI","JULI","AGUSTUS","SEPTEMBER","OKTOBER","NOVEMBER","DESEMBER"];
        let res = `*LAPORAN ITEM FOKUS ${shift} AREA PAK FADHOLI*\n${d.getDate()} ${bln[d.getMonth()]} ${d.getFullYear()}\n\n`;
        const items = [{n:"SALES", id:"s", h:"TOKO: target//act//acv\n"},{n:"AQUA 600ml/1.5l", id:"aq", l:"*üç∂", r:"üç∂*"},{n:"Dua Kelinci", id:"dk", l:"*ü•ú", r:"üê∞*"},{n:"Garnier FF", id:"gr", l:"*üöø", r:"üíÜüèª‚Äç‚ôÄÔ∏è*"},{n:"Lifebuoy", id:"lf", l:"*üöø", r:"üõÅ*"},{n:"Pepsodent", id:"pp", l:"*ü™•", r:"üö∞*"},{n:"Sunlight", id:"sn", l:"*üçΩÔ∏è", r:"üßº*"},{n:"CUT FRUIT", id:"f", l:"üççüçâ *", r:"* üçâüçç", s:true},{n:"TTM", id:"tm", l:"üî•üî• *", r:"* üî•üî•"},{n:"PULSA", id:"p", l:"üè¥‚Äç‚ò†Ô∏èüè¥‚Äç‚ò†Ô∏è *", r:"* üè¥‚Äç‚ò†Ô∏èüè¥‚Äç‚ò†Ô∏è", p:true},{n:"CASHBACK", id:"cs", l:"‚ú®‚ú® *", r:"* ‚ú®‚ú®", s:true}];
        items.forEach(it => {
            res += (it.id === 's') ? it.h : `\n${it.l}${it.n}${it.r}\n\n`;
            tokoList.forEach((tk, i) => {
                let actRaw = document.getElementById(`${it.id}_${i}`).value || "";
                let actNum = parseInt(actRaw.replace(/[^0-9]/g, '')) || 0;
                let acv = document.getElementById(`acv_${it.id}_${i}`).innerText;
                if(it.id === 's') { res += `${i+1}.${tk.n}//${formatNumber(tk.s)}/${actNum === 0 ? '' : formatNumber(actNum)}/${actNum === 0 ? '' : acv}\n`; } 
                else if(it.s) { res += `${i+1}.${tk.n} /${actNum === 0 ? '' : formatNumber(actNum)}\n`; } 
                else { let tgtDisp = it.p ? "200k" : (it.id==='tm'?(tk.n==="CRLW"?"25":"50"):tk[it.id]); let actDisp = it.p ? (actNum === 0 ? '0k' : actNum + 'k') : actNum; res += `${i+1}.${tk.n}/${tgtDisp}/${actNum === 0 ? '' : actDisp}/${actNum === 0 ? '' : acv}\n`; }
            });
        });
        const el = document.createElement('textarea'); el.value = res; document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el);
        showToast("LAPORAN DISALIN");
    }
</script>
</body>
</html>
