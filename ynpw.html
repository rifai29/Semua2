<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MONITORING FADHOLI - V20.1 INSTANT RESET</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #f8fafc; --panel: #ffffff; --primary: #1e293b; --green: #10b981; --border: #e2e8f0; }
        * { box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: var(--primary); margin: 0; padding: 0; }
        .header { background: var(--panel); padding: 20px; text-align: center; border-bottom: 1px solid var(--border); }
        .header h1 { margin: 0; font-size: 15px; font-weight: 800; text-transform: uppercase; color: #334155; }
        .container { max-width: 1400px; margin: 0 auto; padding: 15px; }
        .card { background: var(--panel); border-radius: 12px; padding: 20px; border: 1px solid var(--border); box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; }
        textarea { width: 100%; height: 110px; border: 1.5px solid #cbd5e1; border-radius: 10px; padding: 12px; font-size: 13px; outline: none; background: #fcfcfc; margin-bottom: 12px; }
        .btn-box { display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 10px; }
        .btn { border: none; border-radius: 8px; padding: 14px; font-weight: 700; font-size: 11px; text-transform: uppercase; cursor: pointer; color: white; }
        .btn-go { background: #334155; } .btn-wa { background: #64748b; } .btn-cl { background: #e2e8f0; color: #475569; }
        .table-res { background: var(--panel); border-radius: 12px; border: 1px solid var(--border); overflow: hidden; box-shadow: 0 10px 15px rgba(0,0,0,0.05); margin-bottom: 30px; }
        .scroll { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 1300px; }
        th { background: #f8fafc; padding: 15px 10px; font-size: 10px; font-weight: 700; color: #94a3b8; text-transform: uppercase; border-bottom: 2px solid var(--border); }
        .stk { position: sticky; left: 0; background: white; z-index: 10; border-right: 2px solid var(--border); width: 140px; text-align: left !important; padding-left: 15px; }
        td { padding: 12px 5px; border-bottom: 1px solid #f1f5f9; text-align: center; }
        .st-nm { font-weight: 800; font-size: 12px; }
        .stack { display: flex; flex-direction: column; align-items: center; gap: 2px; }
        .t-val { font-size: 9px; color: #94a3b8; font-weight: 600; }
        .in-val { width: 85%; border: none; background: transparent; text-align: center; font-size: 14px; font-weight: 800; color: #1e293b; outline: none; }
        .p-val { font-size: 11px; font-weight: 800; color: var(--green); height: 16px; }
        #toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #1e293b; color: white; padding: 12px 25px; border-radius: 50px; font-size: 12px; opacity: 0; transition: 0.4s; z-index: 999; }
    </style>
</head>
<body>

<div class="header"><h1 id="mainTitle">Monitoring Fadholi</h1></div>

<div class="container">
    <div class="card">
        <textarea id="txtIn" placeholder="Tempel Laporan di sini..."></textarea>
        <div class="btn-box">
            <button class="btn btn-go" onclick="proData()">PROSES</button>
            <button class="btn btn-wa" onclick="waCopy()">SALIN</button>
            <button class="btn btn-cl" onclick="resTab()">Hapus</button>
        </div>
    </div>

    <div class="table-res">
        <div class="scroll">
            <table>
                <thead>
                    <tr>
                        <th class="stk">Nama Toko</th>
                        <th>Sales</th><th>Lux 800ml</th><th>Pond's 100/90ml</th><th>Rinso 700g</th><th>Sunsilk 160ml</th>
                        <th>Whiskas 80g</th><th>Wipol 750ml</th><th>Cut Fruit</th><th>TTM</th><th>Pulsa</th><th>Casback</th>
                    </tr>
                </thead>
                <tbody id="outBody"></tbody>
            </table>
        </div>
    </div>
</div>

<div id="toast">Notif</div>

<script>
    const stores = [
        { id: "ANBA", t: { s: 17599926, lx: 1, pd: 2, rn: 4, ss: 1, ws: 6, wp: 5, cf: 0, tm: 50, p: 200, cb: 0 } },
        { id: "YNPW", t: { s: 21645276, lx: 1, pd: 2, rn: 4, ss: 2, ws: 4, wp: 5, cf: 0, tm: 50, p: 200, cb: 0 } },
        { id: "GDGN", t: { s: 25401388, lx: 1, pd: 2, rn: 2, ss: 2, ws: 4, wp: 2, cf: 0, tm: 50, p: 200, cb: 0 } },
        { id: "GRGB", t: { s: 28622850, lx: 1, pd: 3, rn: 4, ss: 2, ws: 3, wp: 4, cf: 0, tm: 50, p: 200, cb: 0 } },
        { id: "PLMN", t: { s: 21523517, lx: 3, pd: 2, rn: 3, ss: 2, ws: 8, wp: 7, cf: 0, tm: 50, p: 200, cb: 0 } },
        { id: "FMI",  t: { s: 25512077, lx: 2, pd: 2, rn: 4, ss: 2, ws: 6, wp: 6, cf: 0, tm: 50, p: 200, cb: 0 } },
        { id: "WMI",  t: { s: 17526288, lx: 2, pd: 2, rn: 2, ss: 1, ws: 3, wp: 5, cf: 0, tm: 50, p: 200, cb: 0 } },
        { id: "PDA",  t: { s: 21904787, lx: 2, pd: 2, rn: 2, ss: 1, ws: 5, wp: 4, cf: 0, tm: 50, p: 200, cb: 0 } },
        { id: "KTL",  t: { s: 15492335, lx: 1, pd: 1, rn: 1, ss: 1, ws: 3, wp: 3, cf: 0, tm: 50, p: 200, cb: 0 } },
        { id: "CRLW", t: { s: 15421747, lx: 1, pd: 5, rn: 3, ss: 2, ws: 3, wp: 4, cf: 0, tm: 50, p: 200, cb: 0 } }
    ];

    const cols = [
        { id: "s", k: "SALES", h: true, head: "SALES" },
        { id: "lx", k: "LUX", h: true, head: "*ðŸ«§Lux 800mlðŸ«§*" },
        { id: "pd", k: "POND", h: true, head: "*ðŸ‘©ðŸ»Pond's 100/90mlðŸ‘©ðŸ»*" },
        { id: "rn", k: "RINSO", h: true, head: "*ðŸ‘šRinso 700gðŸ‘š*" },
        { id: "ss", k: "SUNSILK", h: true, head: "*ðŸ’†ðŸ»â€â™€ï¸Sunsilk 160mlðŸ§–ðŸ»â€â™€ï¸*" },
        { id: "ws", k: "WHISKAS", h: true, head: "*ðŸ±whiskas 80gðŸ±*" },
        { id: "wp", k: "WIPOL", h: true, head: "*ðŸª£Wipol 750mlðŸª£*" },
        { id: "cf", k: "CUT FRUIT", h: false, head: "ðŸðŸ‰ *CUT FRUIT* ðŸ‰ðŸ" },
        { id: "tm", k: "TTM", h: true, head: "ðŸ”¥ðŸ”¥ *TTM* ðŸ”¥ðŸ”¥" },
        { id: "p", k: "PULSA", h: true, head: "ðŸ´â€â˜ ï¸ðŸ´â€â˜ ï¸ *PULSA* ðŸ´â€â˜ ï¸ðŸ´â€â˜ ï¸" },
        { id: "cb", k: "CASHBACK", h: false, head: "âœ¨âœ¨ *CASHBACK* âœ¨âœ¨" }
    ];

    function getShiftInfo() {
        const now = new Date();
        const hr = now.getHours();
        const mn = now.getMinutes();
        const time = hr + (mn/100);
        const bulan = ["JANUARI","FEBRUARI","MARET","APRIL","MEI","JUNI","JULI","AGUSTUS","SEPTEMBER","OKTOBER","NOVEMBER","DESEMBER"];
        const tglStr = `${now.getDate()} ${bulan[now.getMonth()]} ${now.getFullYear()}`;
        let shift = (time > 20.00 || time <= 2.00) ? "SIANG" : "PAGI";
        return { shift, tglStr };
    }

    function render() {
        const info = getShiftInfo();
        document.getElementById('mainTitle').innerText = `Tahap Percobaan ( ${info.shift} )`;
        const b = document.getElementById('outBody');
        b.innerHTML = stores.map((s, i) => `
            <tr>
                <td class="stk"><span class="st-nm">${s.id}</span></td>
                ${cols.map(c => `<td><div class="stack">
                    <span class="t-val">${s.t[c.id]>0 ? (c.id=='s' ? s.t[c.id].toLocaleString('id-ID'):s.t[c.id]):''}</span>
                    <input type="text" id="v_${c.id}_${i}" class="in-val" placeholder="0" oninput="calc(${i},'${c.id}',${s.t[c.id]},${c.h})">
                    <span class="p-val" id="p_${c.id}_${i}"></span>
                </div></td>`).join('')}
            </tr>`).join('');
    }

    function calc(i, cid, tg, h) {
        let iv = document.getElementById(`v_${cid}_${i}`), pv = document.getElementById(`p_${cid}_${i}`);
        let rv = iv.value.replace(/[^0-9]/g, '');
        if (!h || rv==="" || rv==="0" || tg===0) { pv.innerText = ""; return; }
        pv.innerText = Math.round((parseInt(rv)/tg)*100) + "%";
    }

    function proData() {
        const raw = document.getElementById('txtIn').value.toUpperCase();
        if (!raw) return;
        let mode = "s";
        raw.split('\n').forEach(l => {
            cols.forEach(c => { if(l.includes(c.k)) mode = c.id; });
            stores.forEach((s, i) => {
                if (l.includes(s.id)) {
                    let norm = l.replace(/\/\//g, '/');
                    let parts = norm.split('/');
                    let val = (mode === 'cf' || mode === 'cb') ? parts[1] : parts[2];
                    let clean = (val || "").replace(/[^0-9]/g, '').trim();
                    if (clean !== "" && clean !== "0") {
                        document.getElementById(`v_${mode}_${i}`).value = clean;
                        calc(i, mode, s.t[mode], cols.find(x=>x.id===mode).h);
                    }
                }
            });
        });
        show("Berhasil");
    }

    function waCopy() {
        const info = getShiftInfo();
        let r = `*LAPORAN ITEM FOKUS ${info.shift} AREA PAK FADHOLI*\n${info.tglStr}\n\nTOKO: target//act//acv\n`;
        stores.forEach((s, i) => {
            let actInput = document.getElementById(`v_s_${i}`).value;
            let actVal = actInput.replace(/[^0-9]/g, '');
            let targetSales = s.t.s.toLocaleString('id-ID');
            if(actVal && actVal !== "0") {
                let fmt = actVal.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                let acv = document.getElementById(`p_s_${i}`).innerText;
                r += `${i+1}.${s.id} //${targetSales}/${fmt}/${acv}\n`;
            } else r += `${i+1}.${s.id} //${targetSales}//\n`;
        });
        cols.slice(1).forEach(c => {
            r += `\n${c.head}\n\n`;
            stores.forEach((s, i) => {
                let actInput = document.getElementById(`v_${c.id}_${i}`).value || "";
                let actVal = actInput.replace(/[^0-9]/g, '');
                let targetItem = s.t[c.id];
                if(actVal && actVal !== "0") {
                    let acv = document.getElementById(`p_${c.id}_${i}`).innerText;
                    let displayAct = actVal + (c.id==='p'?'k':'');
                    if(c.id === 'cf' || c.id === 'cb') r += `${i+1}. ${s.id}/${displayAct}\n`;
                    else r += `${i+1}. ${s.id}/${targetItem}/${displayAct}/${acv}\n`;
                } else {
                    if(c.id === 'cf' || c.id === 'cb') r += `${i+1}. ${s.id}/\n`;
                    else r += `${i+1}. ${s.id}/${targetItem}/\n`;
                }
            });
        });
        const tmp = document.createElement('textarea'); tmp.value = r.trim(); document.body.appendChild(tmp); tmp.select();
        document.execCommand('copy'); document.body.removeChild(tmp);
        show("Berhasil");
    }

    function resTab() { 
        document.getElementById('txtIn').value = ""; 
        render(); 
        show("Berhasil"); 
    }

    function show(m) { 
        let t = document.getElementById('toast'); 
        t.innerText = m; 
        t.style.opacity = '1'; 
        setTimeout(() => t.style.opacity = '0', 2500); 
    }

    window.onload = render;
</script>
</body>
</html>
