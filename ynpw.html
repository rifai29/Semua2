<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Generator Area Pak Fadholi v2.5.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --midi-red: #c1121c; 
            --off-white: #f8fafc; 
            --pure-white: #ffffff;
            --border-color: #e2e8f0;
            --text-dark: #1e293b;
            --text-muted: #64748b;
        }

        * { box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--off-white); margin: 0; padding: 0; color: var(--text-dark); }
        
        .navbar { 
            background: var(--pure-white); 
            padding: 14px 20px; 
            font-weight: 700; 
            font-size: 13px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .main-content { padding: 12px; max-width: 600px; margin: 0 auto; }

        .card { 
            background: var(--pure-white); 
            border-radius: 8px; 
            border-top: 4px solid var(--midi-red);
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            margin-bottom: 16px;
            overflow: hidden;
        }

        textarea { 
            width: 100%; border: none; padding: 15px; font-size: 12px;
            outline: none; resize: none; background: transparent;
            min-height: 80px;
        }

        .menu-list { display: flex; flex-direction: column; }
        .btn-action {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            background: none;
            border: none;
            padding: 12px 16px;
            font-weight: 700;
            font-size: 11px;
            color: var(--text-dark);
            cursor: pointer;
            border-top: 1px solid var(--border-color);
            text-transform: uppercase;
        }
        .btn-process { color: var(--midi-red); }

        .monitoring-title { font-size: 10px; font-weight: 700; color: var(--text-muted); margin-bottom: 8px; text-transform: uppercase; }

        .table-scroll { 
            height: 400px; 
            overflow: auto; 
            background: var(--pure-white);
            border: 1px solid var(--border-color);
            border-radius: 6px;
        }

        table { border-collapse: collapse; width: 100%; min-width: 1300px; font-size: 11px; }
        th { position: sticky; top: 0; background: #f8fafc; padding: 10px; color: var(--text-muted); border-bottom: 2px solid #edf2f7; z-index: 10; font-size: 10px; }
        td { padding: 8px 4px; border-bottom: 1px solid #f1f5f9; text-align: center; vertical-align: top; }
        
        .toko-col { 
            position: sticky; left: 0; background: #fffdf2; 
            z-index: 5; border-right: 2px solid #ffcc00; 
            min-width: 115px; text-align: left; vertical-align: middle;
        }
        .nama-full { display: block; font-size: 8px; color: #666; text-transform: uppercase; line-height: 1.1; }
        .nama-kode { display: block; font-size: 11px; color: var(--midi-red); font-weight: 700; }

        .target-label { display: block; font-size: 9px; color: #94a3b8; font-weight: bold; margin-bottom: 4px; }
        
        input[type="text"] { 
            width: 80px; padding: 6px; border: 1px solid #cbd5e1; 
            border-radius: 6px; text-align: center; font-size: 11px; font-weight: bold;
        }
        .acv-indicator { display: block; font-size: 9px; font-weight: bold; color: #059669; margin-top: 3px; }

        #toast { position: fixed; bottom: 35px; left: 50%; transform: translateX(-50%); background: #1e293b; color: white; padding: 10px 20px; border-radius: 30px; font-size: 11px; font-weight: bold; opacity: 0; transition: 0.4s; z-index: 2000; }
    </style>
</head>
<body>

<div class="navbar">
    GENERATOR FADHOLI
    <span style="font-size: 10px; color: var(--text-muted); font-weight: 400;">v2.5.0</span>
</div>

<div class="main-content">
    <div class="card">
        <textarea id="rawInput" placeholder="Tempel laporan di sini (SALES, LUX, PONDS, dll)..."></textarea>
        <div class="menu-list">
            <button class="btn-action btn-process" onclick="importData()">PROSES DATA <span>‚ùØ</span></button>
            <button class="btn-action" onclick="copyWA()">SALIN LAPORAN <span>‚ùØ</span></button>
            <button class="btn-action" style="color: #94a3b8;" onclick="clearAll()">HAPUS <span>‚ùØ</span></button>
        </div>
    </div>

    <div class="monitoring-title">Data Monitoring (10 Toko)</div>
    <div class="card" style="padding: 8px;">
        <div class="table-scroll" id="tableContent"></div>
    </div>
</div>

<div id="toast">Berhasil Disalin</div>

<script>
    const tokoList = [
        { n: "ANBA", full: "ALUN-ALUN BLORA", s: "17599926" },
        { n: "YNPW", full: "A. YANI PURWODADI", s: "21645276" },
        { n: "GDGN", full: "GODONG GROBOGAN", s: "25401388" },
        { n: "GRGB", full: "GUBUG GROBOGAN", s: "28622850" },
        { n: "PLMN", full: "PLAMONGAN", s: "21523517" },
        { n: "FMI",  full: "FATMAWATI", s: "25512077" },
        { n: "WMI",  full: "WOLTER MONGINSIDI", s: "17526288" },
        { n: "PDA",  full: "PADIRAYA", s: "21904787" },
        { n: "KTL",  full: "KETILENG", s: "15492335" },
        { n: "CRLW", full: "CEPU RONGGOLAWE", s: "15421747" }
    ];

    // Field definition: s=sales, lx=lux, pd=ponds, rn=rinso, ss=sunsilk, ws=whiskas, wp=wipol, cf=cutfruit, tm=ttm, p=pulsa, cb=cashback
    const fields = [
        { id: 's',  name: 'SALES', target: (tk) => tk.s, label: (tk) => formatNumber(tk.s) },
        { id: 'lx', name: 'LUX 800', target: () => 1 },
        { id: 'pd', name: 'PONDS', target: () => 2 },
        { id: 'rn', name: 'RINSO', target: () => 3 },
        { id: 'ss', name: 'SUNSILK', target: () => 2 },
        { id: 'ws', name: 'WHISKAS', target: () => 5 },
        { id: 'wp', name: 'WIPOL', target: () => 4 },
        { id: 'cf', name: 'FRUIT', target: () => 0, isString: true },
        { id: 'tm', name: 'TTM', target: (tk) => tk.n === 'CRLW' ? 0 : 50 },
        { id: 'p',  name: 'PULSA', target: () => 200, label: () => '200k' },
        { id: 'cb', name: 'CASHBACK', target: () => 0, isString: true }
    ];

    function initTable() {
        let html = `<table><thead><tr><th>TOKO</th>`;
        fields.forEach(f => html += `<th>${f.name}</th>`);
        html += `</tr></thead><tbody>`;
        
        tokoList.forEach((tk, i) => {
            html += `<tr><td class="toko-col"><span class="nama-full">${tk.full}</span><span class="nama-kode">${tk.n}</span></td>`;
            fields.forEach(f => {
                let tgtVal = f.target(tk);
                let tgtDisp = f.label ? f.label(tk) : (tgtVal === 0 ? '-' : tgtVal);
                html += `<td><span class="target-label">${tgtDisp}</span><input type="text" id="${f.id}_${i}" oninput="calc('${i}','${f.id}','${tgtVal}')"><span id="acv_${f.id}_${i}" class="acv-indicator">0%</span></td>`;
            });
            html += `</tr>`;
        });
        document.getElementById('tableContent').innerHTML = html + `</tbody></table>`;
    }

    function formatNumber(n) { return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."); }
    function showToast(m) { const t = document.getElementById('toast'); t.innerText = m; t.style.opacity = '1'; setTimeout(() => t.style.opacity = '0', 2000); }

    function calc(i, fid, target) {
        let val = document.getElementById(`${fid}_${i}`).value.replace(/[^0-9]/g, '');
        let a = parseInt(val) || 0, t = parseInt(target) || 0;
        document.getElementById(`acv_${fid}_${i}`).innerText = (t > 0) ? Math.round((a/t)*100) + "%" : "0%";
    }

    function clearAll() {
        document.querySelectorAll('textarea, input').forEach(el => el.value = "");
        document.querySelectorAll('.acv-indicator').forEach(el => el.innerText = "0%");
        showToast("BERSIH");
    }

    function importData() {
        const text = document.getElementById('rawInput').value.toUpperCase();
        if(!text) return;
        
        const keyMap = { 
            "LUX":"lx", "POND":"pd", "RINSO":"rn", "SUNSILK":"ss", 
            "WHISKAS":"ws", "WIPOL":"wp", "CUT FRUIT":"cf", "TTM":"tm", "PULSA":"p", "CASHBACK":"cb" 
        };

        const lines = text.split('\n');
        let currentMode = "s";

        lines.forEach(line => {
            // Deteksi Mode berdasarkan header item
            for (let key in keyMap) {
                if(line.includes(key)) { currentMode = keyMap[key]; return; }
            }

            // Cari Toko dan ambil angka
            tokoList.forEach((tk, i) => {
                if(line.includes(tk.n)) {
                    let parts = line.split('/').map(p => p.trim());
                    let val = "";
                    if (currentMode === 's') {
                        val = parts[2] || ""; // Ambil ACV untuk sales
                    } else {
                        val = parts[parts.length - 2] || parts[1] || ""; // Ambil nilai sebelum slash terakhir
                    }
                    
                    let cleanVal = val.replace(/[^0-9]/g, '');
                    document.getElementById(`${currentMode}_${i}`).value = cleanVal;
                    calc(i, currentMode, fields.find(f => f.id === currentMode).target(tk));
                }
            });
        });
        showToast("DATA DIPROSES");
    }

    function copyWA() {
        const d = new Date();
        const bln = ["JANUARI","FEBRUARI","MARET","APRIL","MEI","JUNI","JULI","AGUSTUS","SEPTEMBER","OKTOBER","NOVEMBER","DESEMBER"];
        let res = `*LAPORAN ITEM FOKUS PAGI AREA PAK FADHOLI*\n${d.getDate()} ${bln[d.getMonth()]} ${d.getFullYear()}\n\n`;
        
        const reportItems = [
            { id: 's',  head: "TOKO: target//act//acv\n", emoji: "" },
            { id: 'lx', head: "ü´ßLux 800mlü´ß", emoji: "" },
            { id: 'pd', head: "üë©üèªPond's 100/90mlüë©üèª", emoji: "" },
            { id: 'rn', head: "üëöRinso 700güëö", emoji: "" },
            { id: 'ss', head: "üíÜüèª‚Äç‚ôÄÔ∏èSunsilk 160mlüßñüèª‚Äç‚ôÄÔ∏è", emoji: "" },
            { id: 'ws', head: "üê±whiskas 80güê±", emoji: "" },
            { id: 'wp', head: "ü™£Wipol 750mlü™£", emoji: "" },
            { id: 'cf', head: "üççüçâ *CUT FRUIT* üçâüçç", emoji: "", isS: true },
            { id: 'tm', head: "üî•üî• *TTM* üî•üî•", emoji: "" },
            { id: 'p',  head: "üè¥‚Äç‚ò†Ô∏èüè¥‚Äç‚ò†Ô∏è *PULSA* üè¥‚Äç‚ò†Ô∏èüè¥‚Äç‚ò†Ô∏è", emoji: "", isP: true },
            { id: 'cb', head: "‚ú®‚ú® *CASHBACK* ‚ú®‚ú®", emoji: "", isS: true }
        ];

        reportItems.forEach(item => {
            res += (item.id === 's') ? item.head : `\n${item.head}\n\n`;
            tokoList.forEach((tk, i) => {
                let act = document.getElementById(`${item.id}_${i}`).value || "";
                let acv = document.getElementById(`acv_${item.id}_${i}`).innerText;
                let tgt = fields.find(f => f.id === item.id).target(tk);

                if(item.id === 's') {
                    res += `${i+1}.${tk.n} //${formatNumber(tk.s)}/${act ? formatNumber(act) : ''}/${act ? acv : ''}\n`;
                } else if(item.isS) {
                    res += `${i+1}.${tk.n} /${act}/\n`;
                } else if(item.isP) {
                    res += `${i+1}.${tk.n}/${tgt}k/${act ? act + 'k' : ''}/${act ? acv : ''}/\n`;
                } else {
                    res += `${i+1}.${tk.n}/${tgt}/${act}/${act ? acv : ''}/\n`;
                }
            });
        });

        const el = document.createElement('textarea'); el.value = res; document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el);
        showToast("LAPORAN DISALIN");
    }

    initTable();
</script>
</body>
</html>
