<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Alfamidi HR Premium - Monokrom</title>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --accent-black: #222222; 
            --text-main: #333333; 
            --text-muted: #888888; 
            --border-color: #dddddd; 
            --bg-light: #f5f5f5;
            --bg-white: #ffffff;
            --grey-action: #666666;
            --red-logout: #ff3b30;
        }

        * { box-sizing: border-box; font-family: 'Inter', sans-serif; margin: 0; padding: 0; }
        body { background-color: var(--bg-white); color: var(--text-main); -webkit-tap-highlight-color: transparent; overflow-x: hidden; }

        /* NAVBAR */
        .navbar { background: var(--bg-white); padding: 18px 20px; display: flex; align-items: center; position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid var(--border-color); gap: 12px; }
        .menu-btn { background: none; border: none; font-size: 28px; cursor: pointer; padding: 0; color: var(--text-main); display: flex; align-items: center; }
        .nav-title { font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; font-size: 1.1rem; color: var(--text-main); }
        
        /* SIDEBAR - Spasi atas dikurangi agar teks naik */
        .sidebar { position: fixed; left: -100%; top: 0; height: 100%; width: 75%; background: var(--bg-white); transition: 0.3s ease; z-index: 1100; padding-top: 20px; box-shadow: 10px 0 20px rgba(0,0,0,0.05); }
        .sidebar.active { left: 0; }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.3); display: none; z-index: 1050; }
        .overlay.active { display: block; }

        /* Nav Item Sizing: 13px, Bold, Padding 15px 25px */
        .nav-item { 
            display: block; 
            padding: 15px 25px; 
            font-weight: 700; 
            font-size: 13px; 
            text-decoration: none; 
            color: var(--text-main); 
            text-transform: uppercase; 
            cursor: pointer; 
        }
        .nav-divider { height: 1px; background-color: var(--border-color); margin: 5px 0; width: 100%; }

        /* UI ELEMENTS */
        .container { padding: 15px; max-width: 480px; margin: auto; }
        .card { background: var(--bg-white); border-radius: 16px; padding: 20px; margin-bottom: 15px; border: 1px solid var(--border-color); }
        label { display: block; font-size: 0.65rem; font-weight: 700; color: var(--text-muted); margin-bottom: 8px; text-transform: uppercase; }
        input { width: 100%; padding: 14px; border: 1.5px solid var(--border-color); border-radius: 12px; margin-bottom: 15px; outline: none; font-size: 0.95rem; color: var(--text-main); }
        .action-row { display: flex; gap: 10px; align-items: center; }
        .btn-primary { flex: 2; padding: 18px; border: none; border-radius: 12px; background: var(--accent-black); color: white; font-weight: 700; text-transform: uppercase; cursor: pointer; font-size: 0.85rem; }
        .total-box { flex: 1; background: var(--bg-light); padding: 8px; border-radius: 12px; text-align: center; border: 1.5px solid var(--border-color); height: 58px; display: flex; flex-direction: column; justify-content: center; }
        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 20px; }
        .btn-outline { padding: 14px; border: 1.5px solid var(--border-color); border-radius: 12px; background: var(--bg-white); font-weight: 700; font-size: 0.75rem; text-transform: uppercase; cursor: pointer; text-align: center; color: var(--text-main); display: flex; align-items: center; justify-content: center; }
        
        /* TABLE */
        .data-row { display: grid; grid-template-columns: 75px 1fr 85px; padding: 12px 5px; border-bottom: 1px solid var(--bg-light); font-size: 0.72rem; text-align: center; align-items: center; }
        .nama-col { font-weight: 600; text-align: left; padding: 0 8px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--text-main); }

        /* MODAL */
        .modal { position: fixed; inset: 0; background: var(--bg-white); z-index: 2000; display: none; flex-direction: column; }
        .modal.active { display: flex; }
        .modal-header { padding: 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); }
        .modal-body { padding: 15px; overflow-y: auto; flex-grow: 1; background: var(--bg-light); }
        .list-card { background: var(--bg-white); border-radius: 14px; padding: 16px; margin-bottom: 12px; border: 1px solid var(--border-color); }

        /* BUTTONS IN MODAL */
        .btn-modal-action { width: 100%; padding: 10px; border-radius: 8px; cursor: pointer; font-weight: 700; font-size: 0.7rem; text-transform: uppercase; border: 1px solid var(--border-color); background: var(--bg-white); color: var(--text-main); margin-top: 10px; }
        .btn-half { flex: 1; padding: 8px; border-radius: 8px; cursor: pointer; font-weight: 700; font-size: 0.65rem; border: 1px solid var(--border-color); background: var(--bg-white); color: var(--text-main); }

        #toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: var(--accent-black); color: #fff; padding: 12px 25px; border-radius: 50px; font-size: 0.75rem; display: none; z-index: 3000; }
    </style>
</head>
<body>

<div class="overlay" id="overlay" onclick="toggleMenu()"></div>

<div class="sidebar" id="sidebar">
    <a href="index.html" class="nav-item">BERANDA</a>
    <div class="nav-divider"></div>
    <a href="index.html" class="nav-item" style="color:var(--red-logout)">LOGOUT</a>
</div>

<nav class="navbar">
    <button class="menu-btn" onclick="toggleMenu()">☰</button>
    <div class="nav-title">TAHAP PERCOBAAN</div>
</nav>

<div class="container">
    <div class="card">
        <label>Input Karyawan</label>
        <input type="tel" id="nik" placeholder="NIK" onkeyup="logicMasa(this.value, 'masa')">
        <input type="text" id="nama" placeholder="Nama" oninput="this.value = this.value.toUpperCase()">
        <input type="text" id="masa" readonly placeholder="Masa" style="background:var(--bg-light); font-weight: 700; border-color: transparent;">

        <div class="action-row">
            <button class="btn-primary" onclick="simpan()">SIMPAN</button>
            <div class="total-box">
                <span style="font-size:0.5rem; font-weight:800; color:var(--text-muted)">AKTIF</span>
                <h2 id="totalCount" style="font-size:1.1rem; font-weight:800">0</h2>
            </div>
        </div>
    </div>

    <div class="card" style="padding: 15px 5px;">
        <label style="margin-left: 10px;">Daftar Karyawan</label>
        <div class="data-row" style="font-weight:800; color:var(--text-muted); font-size:0.6rem; border-bottom: 2px solid var(--bg-light); padding-bottom: 8px;">
            <span>NIK</span><span>NAMA LENGKAP</span><span>MASA</span>
        </div>
        <div id="mainTable" style="max-height: 300px; overflow-y: auto;"></div>

        <div class="action-grid" style="padding: 0 10px;">
            <button class="btn-outline" onclick="unduh()">EKSPOR</button>
            <label class="btn-outline">
                IMPOR <input type="file" hidden onchange="imporExcel(this)">
            </label>
            <button class="btn-outline" onclick="openSemuaModal()">SEMUA</button>
            <button class="btn-outline" onclick="openSampahModal()">HAPUS</button>
        </div>
    </div>
</div>

<div id="actionModal" class="modal">
    <div class="modal-header">
        <h3 id="modalTitle" style="font-weight: 800; font-size: 1rem;">DAFTAR DATA</h3>
        <button onclick="closeModal()" style="border:none; background:var(--bg-light); width: 32px; height: 32px; border-radius: 50%; font-size: 16px; cursor: pointer;">✕</button>
    </div>
    <div id="modalList" class="modal-body"></div>
</div>

<div id="toast">Notifikasi</div>

<script>
    let dbAktif = JSON.parse(localStorage.getItem('hr_final_v1')) || [];
    let dbSampah = JSON.parse(localStorage.getItem('hr_final_trash_v1')) || [];

    function toggleMenu() {
        document.getElementById('sidebar').classList.toggle('active');
        document.getElementById('overlay').classList.toggle('active');
    }

    function logicMasa(nik, targetIdOrReturn) {
        let val = nik.replace(/[^0-9]/g, '');
        if (val.length >= 6) {
            const thn = parseInt("20" + val.substring(2, 4));
            const bln = parseInt(val.substring(4, 6)) - 1;
            const tglMasuk = new Date(thn, bln, 1);
            const tglSkr = new Date();
            let totalBulan = (tglSkr.getFullYear() - tglMasuk.getFullYear()) * 12 + (tglSkr.getMonth() - tglMasuk.getMonth());
            let hasil = (totalBulan < 0) ? "0 Thn 0 Bln" : Math.floor(totalBulan/12) + " Thn " + (totalBulan%12) + " Bln";
            if(targetIdOrReturn === 'masa') document.getElementById('masa').value = hasil;
            return hasil;
        }
        if(targetIdOrReturn === 'masa') document.getElementById('masa').value = "";
        return "0 Thn 0 Bln";
    }

    function simpan() {
        const nik = document.getElementById('nik').value;
        const nama = document.getElementById('nama').value;
        const masa = document.getElementById('masa').value;
        if(!nik || !nama) return showToast("Isi NIK & Nama!");
        dbAktif.unshift({ nik, nama, masa: masa || "0 Thn 0 Bln" });
        saveAll();
        reset();
        showToast("Tersimpan!");
    }

    function renderAktif() {
        document.getElementById('totalCount').innerText = dbAktif.length;
        document.getElementById('mainTable').innerHTML = dbAktif.map(i => `
            <div class="data-row">
                <span>${i.nik}</span>
                <span class="nama-col">${i.nama}</span>
                <span style="color:var(--text-muted)">${i.masa}</span>
            </div>
        `).join('');
    }

    function saveAll() {
        localStorage.setItem('hr_final_v1', JSON.stringify(dbAktif));
        localStorage.setItem('hr_final_trash_v1', JSON.stringify(dbSampah));
        renderAktif();
    }

    function openSemuaModal() {
        const modal = document.getElementById('actionModal');
        const list = document.getElementById('modalList');
        document.getElementById('modalTitle').innerText = "DATA AKTIF";
        list.innerHTML = dbAktif.length === 0 ? '<div style="text-align:center; padding:30px; color:var(--text-muted)">Kosong</div>' : "";
        modal.classList.add('active');
        dbAktif.forEach((item, idx) => {
            list.innerHTML += `
                <div class="list-card">
                    <b>${item.nama}</b><br><small style="color:var(--text-muted)">${item.nik} | ${item.masa}</small><br>
                    <button onclick="keSampah(${idx})" class="btn-modal-action">PINDAHKAN KE SAMPAH</button>
                </div>`;
        });
    }

    function openSampahModal() {
        const modal = document.getElementById('actionModal');
        const list = document.getElementById('modalList');
        document.getElementById('modalTitle').innerText = "SAMPAH (DIBERSIHKAN)";
        list.innerHTML = dbSampah.length === 0 ? '<div style="text-align:center; padding:30px; color:var(--text-muted)">Kosong</div>' : "";
        modal.classList.add('active');
        dbSampah.forEach((item, idx) => {
            list.innerHTML += `
                <div class="list-card">
                    <b>${item.nama}</b><br><small style="color:var(--text-muted)">${item.nik}</small><br>
                    <div style="display:flex; gap:8px; margin-top:10px;">
                        <button onclick="pulihkan(${idx})" class="btn-half">PULIHKAN</button>
                        <button onclick="permanen(${idx})" class="btn-half" style="background:var(--bg-light)">HAPUS TOTAL</button>
                    </div>
                </div>`;
        });
    }

    function keSampah(idx) { dbSampah.unshift(dbAktif.splice(idx, 1)[0]); saveAll(); openSemuaModal(); }
    function pulihkan(idx) { dbAktif.unshift(dbSampah.splice(idx, 1)[0]); saveAll(); openSampahModal(); }
    function permanen(idx) { if(confirm("Hapus permanen data ini?")) { dbSampah.splice(idx, 1); saveAll(); openSampahModal(); } }
    
    function unduh() { const ws = XLSX.utils.json_to_sheet(dbAktif); const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "Data"); XLSX.writeFile(wb, "Data_HR.xlsx"); }
    function closeModal() { document.getElementById('actionModal').classList.remove('active'); }
    function reset() { document.getElementById('nik').value = ""; document.getElementById('nama').value = ""; document.getElementById('masa').value = ""; }
    function showToast(m) { const t = document.getElementById('toast'); t.innerText = m; t.style.display = 'block'; setTimeout(() => t.style.display = 'none', 2000); }

    function imporExcel(input) {
        if (!input.files[0]) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            const data = new Uint8Array(e.target.result);
            const wb = XLSX.read(data, {type: 'array'});
            const json = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
            dbAktif = json.map(row => ({
                nik: String(row.nik || row.NIK || ""),
                nama: String(row.nama || row.NAMA || "").toUpperCase(),
                masa: row.masa || row.MASA || logicMasa(String(row.nik || row.NIK || ""), 'return')
            }));
            saveAll();
            showToast("Impor Sukses");
        };
        reader.readAsArrayBuffer(input.files[0]);
    }

    renderAktif();
</script>
</body>
</html>
